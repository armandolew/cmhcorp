package com.medem.service;

import java.util.ArrayList;
import java.util.List;

import org.apache.log4j.BasicConfigurator;
import org.apache.log4j.Logger;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.dao.DataAccessException;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import com.medem.dao.AreaDAO;
import com.medem.dto.AreaDTO;
import com.medem.dto.Assembler;
import com.medem.model.Area;

@Service("areaService")
public class AreaServiceImpl implements AreaService {
	
	@Autowired
	private AreaDAO areaDAO;
	
	private static final Logger logger = Logger.getLogger(AreaServiceImpl.class);

	@Override
	@Transactional
	public void addArea(Area area) {
		this.areaDAO.addArea(area);
		
	}

	@Override
	@Transactional
	public List<AreaDTO> listAreas(int id_company) throws Exception {
		List<AreaDTO> listAreasDTO = new ArrayList<AreaDTO>();
		try{
			for(Area area : areaDAO.listAreas(id_company)){
				listAreasDTO.add(Assembler.createAreaDTO(area));
			}
		}
		catch(DataAccessException dae){
		  throw new Exception();
		}
		return listAreasDTO;
	}

	@Override
	@Transactional
	public AreaDTO getAreaById(int id) throws Exception {
	    try{
		  return Assembler.createAreaDTO(areaDAO.getAreaById(id));
	    }
	    catch(DataAccessException dae){
	        throw new Exception();
	    }
	}

	@Override
	@Transactional
	public Long countAreas(int id_company) {
		return this.areaDAO.countAreas(id_company);
	}

    @Override
    @Transactional
    public void updateArea(Area area) {
        BasicConfigurator.configure();
        try{
          this.areaDAO.updateArea(area);
        }
        catch(DataAccessException dae){
            logger.error("DATA_ACCESS_EXCEPTION: " + dae);
        }
        
    }

	@Override
	@Transactional
	public AreaDTO getFullArea(int areaId){
	    BasicConfigurator.configure();
	    AreaDTO areaDTO = null;
	    try{
	        areaDTO = Assembler.createAreaDTO(this.areaDAO.getFullArea(areaId));
	    }
	    catch(DataAccessException dae){
	        logger.error("DATA_ACCESS_EXCEPTION: " + dae);
	    }
	    
	    return areaDTO;
	}
	

	@Override
	@Transactional
	public List<AreaDTO> searchArea(String name, int companyId){
	    BasicConfigurator.configure();
	    List<AreaDTO> listAreasSearch = new ArrayList<AreaDTO>();
	    
	    try{
	        for(Area area : this.areaDAO.searchArea(name, companyId)){
	            listAreasSearch.add(Assembler.createAreaDTO(area));
	        }
	    }
	    catch(DataAccessException dae){
	        logger.error("DATA_ACCESS_EXCEPTION: " + dae);
	    }
	    
	    return listAreasSearch;
	}
	
	@Override
	@Transactional
	public void deleteArea(Area area){
	    BasicConfigurator.configure();
	    try{
	        this.areaDAO.deleteArea(area);
	    }
	    catch(DataAccessException dae){
	        logger.error("DATA_ACCESS_EXCEPTION: " + dae);
	    }
	}
}

<%@page session="true"%>
<%@taglib uri="http://www.springframework.org/tags/form" prefix="form"%>
<%@ taglib uri="http://www.springframework.org/tags" prefix="spring" %>
<%@taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>

<!DOCTYPE>
  <html>
    <head>
      <meta charset="utf=8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
      <script src="/medem/bootstrap/bootstrap-3.3.2-dist/js/bootstrap.min.js"></script>
      <script type='text/javascript' src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/jquery.validate.js"></script>
	  <script type='text/javascript' src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/additional-methods.js"></script>
	  <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
	  <script src="/medem/js/main_functions.js" ></script>
	  <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
      <link href="/medem/bootstrap/bootstrap-3.3.2-dist/css/bootstrap.min.css" rel="stylesheet">
      <link href="/medem/css/general_layout_override.css" rel="stylesheet">
      <link href="/medem/css/custom.css" rel="stylesheet">
      <title>MEDEM :: Empresa :: Editar Empresa.</title>
    </head><!-- HEAD_END -->
    
    <body id="editCompany">
      <!-- Navigation -->
      <jsp:include page="layouts/navigation_layout.jsp"></jsp:include>
      
      <div id="myModal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h4 class="modal-title"><i class="fa fa-warning"></i> Atenci&#243;n</h4>                          
            </div><!-- .modal-header -->
            <div class="modal-body">
              
            </div><!-- .modal-body -->
          </div><!-- .modal-content -->
        </div><!-- .modal-dialog -->
      </div><!-- .modal fade -->       
      
      <div class="container">
        <div class="row">
          <div class="col-md-8 col-md-offset-2">
            <div class="panel panel-default">
              <div class="panel-heading">
                <h3 class="panel-title">
                  <span class="glyphicon glyphicon-pencil"></span> :: Datos de la nueva empresa
                </h3><!-- .panel-title-->
              </div><!-- .panel-heading -->
              <div class="panel-body">
                <form:form action="/medem/updateCompany" method="POST" modelAttribute="company" id="editCompanyForm">
                  <div class="form-group">
                    <form:label path="name">Nombre de la empresa</form:label>
                    <form:input path="name" class="form-control required_text" value="${company.name}" tabindex="1" />
                  </div><!-- .form-group -->
                  <div class="form-group">
                    <form:label path="bussinesName">Razón social</form:label>
                    <form:input path="bussinesName" class="form-control required-text" value="${company.bussinesName}" tabindex="2" />
                  </div><!-- .form-group -->
                  <div class="form-group">
                    <form:label path="employeeRegistration">Registro patronal</form:label>
                    <form:input path="employeeRegistration" class="form-control required-text" value="${company.employeeRegistration}" tabindex="3" />
                  </div><!-- .form-group -->
   				  <div class="form-group">
   				    <label for="activitySelect">Giro/actividad</label>
   				    <input name="activitySelect" id="activitySelect" class="form-control required-text" value="${company.activity.activity}" tabindex="4" />
   				    <form:hidden path="activity.id" id="activity.id" value="${company.activity.id }" />
   				  </div><!-- .form-group -->
                  <div class="form-group">
                    <form:label path="main_doctor">Doctor asignado:</form:label>
                    <form:select path="main_doctor" class="form-control" tabindex="5">
                      <form:option value="">Doctor asignado</form:option>
                      <form:options items="${usersAvailable}" itemValue="username" itemLabel="username" />
                    </form:select>
                  </div><!-- .form-group -->   				  
                  <form:hidden path="createdBy" value="${company.createdBy }"/>
                  <form:hidden path="createdAt" value="${company.createdAt }" />
                  <form:hidden path="enabled" value="${company.enabled }" />
                  <form:hidden path="id" value="${company.id }" />
                  
                  <div class="form-group">
                    <input type="submit" class="btn btn-block btn-primary" value="Editar Empresa" tabindex="5" />
                  </div><!-- .form-group -->
                </form:form><!-- #newCompany -->
              </div><!-- .panel-body -->
            </div><!-- .panel panel-default -->
          </div><!-- .col-med-8 col-md-offset-2 -->
        </div><!-- .row -->
      </div><!-- .container -->
      
      <!-- Footer -->
      <jsp:include page="layouts/footer_layout.jsp"></jsp:include>
      
    </body><!-- BODY_END -->
    
    <script>
      $(document).ready(function(){
    	  console.log("Done.");
    	  
    	  $('#activitySelect').autocomplete({
    		  minLenght: 3,
    		  delay: 300,
			  source: function(request, response){
				  $.getJSON("${pageContext.request.contextPath}/getTags", request, function(result){
					 console.log(result);
					 response($.map(result, function(item){
					   return{
						   label: item.activity,
						   value: item.id
					   }	 
					 }));
				  });
			  },
    	  
    	  	  select: function(event, ui){
    	  		  event.preventDefault();
                  console.log(ui.item.value);
                  $("#activitySelect").val(ui.item.label);
                  //$("#activity.id").val(ui.item.value);
                  $("#newCompanyForm").find("input[name*='activity.id']").val(ui.item.value);
    	  		  return false;
    	  	  },
    	  	
    	  	  open: function(event, ui) {
                $(".ui-autocomplete").css("z-index", 1000);
              }
    		  
    	  });
    	  
      });
    </script>
  </html><!-- HTML_END -->